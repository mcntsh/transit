!function(n){function e(n){var e;return l()?(n=n||{},i=o.objectExtend(r,n),e=a.find(document,"a",!0),a.bind(e,"click",u),{bind:function(n){a.bind(n,"click",u)},destroy:function(){a.unbind(e,"click",u)}}):!1}var t,o,i,r,a,d,u,c,f,l,s=n.history;t={url:null,title:null},o={noop:function(){},isInternalLink:function(n){var e=new RegExp("^(?:[a-z]+:)?//","i"),t=new RegExp("//"+location.host+"($|/)","i");return n?!(e.test(n)&&!t.test(n)):!1},isHash:function(e){var t=e.indexOf(n.location.pathname)>0?!0:!1,o=e.indexOf("#")>0?!0:!1;return t&&o?!0:!1},objectExtend:function(n,e){var t={};for(var o in n)t[o]=e[o]?e[o]:n[o];return t},getRequest:function(n,e,t,i){var r;r=new XMLHttpRequest,r.open("GET",n,!0),r.addEventListener("progress",i||o.noop,!1),r.onload=function(){r.status>=200&&r.status<400?(e||o.noop).call(this,r):(t||o.noop).call(this,r)},r.send()},middleware:function(n,e,t){e=e instanceof Array?e:[e];var i=function(){this()};e.push(i.bind(t||o.noop)),n.apply(null,e)}},a={find:function(n,e,t){return t="boolean"==typeof t?t:!1,t?(n||document).querySelectorAll(e):(n||document).querySelector(e)},bind:function(n,e,t,o){if("NodeList"===n.constructor.name)for(var i=0;i<n.length;i++)a.bind(n[i],e,t,o);else n instanceof HTMLElement&&n.addEventListener(e,t,!!o)},unbind:function(n,e,t,o){if("NodeList"===n.constructor.name)for(var i=0;i<n.length;i++)a.unbind(n[i],e,t,o);else n instanceof HTMLElement&&n.removeEventListener(e,t,!!o)},parent:function(n,e){return n.parentNode?n.parentNode.tagName.toLowerCase()===e.toLowerCase()?n.parentNode:a.parent(n.parentNode,e):void 0},insertBefore:function(n,e){var t=n.parentNode;t&&t.insertBefore(n,e)}},d={handlePopState:function(n){n.state&&(document.title=n.state.title,u(null,document.location.href,!1))},handlePushState:function(n){document.title=n},push:function(n,e){s.pushState({title:n},n,e),d.handlePushState(n)}},r={context:document.getElementsByTagName("body")[0],beforeLoad:function(n,e){e()},duringLoad:o.noop,afterLoad:function(n,e,t){t()},beforeAppend:function(n,e,t){t()},afterAppend:function(n,e){e()},done:o.noop},u=function(n,e,r){var a=this,u=e||a.href;if(o.isInternalLink(u)){if(n){if(n.metaKey===!0)return;n.preventDefault()}var l=function(){o.getRequest(u,function(n){var e=c(n.responseText),a=f.bind(null,e);t.url=u,r!==!1&&d.push(t.title,t.url),o.middleware(i.afterLoad,[u,e],a)},function(){document.location.href=u},i.duringLoad)};o.middleware(i.beforeLoad,u,l)}},c=function(n){var e,o;return e=document.createElement("div"),e.innerHTML=n,o=a.find(e,"#"+i.context.id),o.id=o.id+"--temp",t.title=a.find(e,"title").innerText,delete e,o},f=function(n){var e,t;e=function(){i.context.innerHTML=n.innerHTML,delete n,o.middleware(i.afterAppend,[i.context],t)},t=function(){var n=a.find(document,"a",!0);a.bind(n,"click",u),o.middleware(i.done)},o.middleware(i.beforeAppend,[n,i.context],e)},l=function(){return s.pushState?(n.onpopstate=d.handlePopState,d.push(a.find(document,"title").innerText,document.location.href),!0):!1},n.transit=e}(this);
